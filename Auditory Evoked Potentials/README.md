# Auditory Evoked Potentials
Brainstorm custom-made process to analyse auditory evoked potentials (AEP).
<BR>Developed mainly to analyse auditory brainstem responses (ABR; an early component of the AEP) but can be used for later potentials such as cortical auditory evoked potentials (CAEP).

## How the processes work
AEPs rely on averaging many hundreds or thousands of stimulus-presented time-locked trials/epochs and all the processes below were made for preprocessed, individual epochs. 
Therefore each individual process takes in X number of epochs and generates one or two files of a single measurement type (e.g. one residual noise measurement from 6000 ABR epochs).
<BR><BR>The individual processes are most useful if the intention is to calculate a single measurement type rather than several at once.
If the intention is to calculate several measurement types (e.g. residual noise, weighted average and noise per epoch from X number of epochs), the combined processes are most useful. 
This is due to the fact that the combined processes were made from various combinations of individual processes. Hence, users can combine individual processes to generate their own combined processes. 
<BR><BR>The following highlights several points the user needs to be aware of before using any of the processes. 
1. The x-axis of files generated by the residual noise and noise per epoch processes = epoch number but the units will = Time (s). Unfortunately, this cannot be changed.
2. ABR Fsp process degrees of freedom = 15. However, this can be easily amended by the user.
3. The time window of files generated by ABR Fsp process = 1.
ABR Fsp process generates a single value and if the time window is not specified Brainstorm will cause an error in opening the file. Therefore, the time window had to be hardcoded to 1. 

### Individual processes
1. **process_abr_fsp.m**
<BR>to be completed.
2. **process_epoch_weighting.m**
<BR>Calculates epoch-specific weighting by taking the inverse of epoch variance. The weighting is then applied to each epoch.
That is, with an input of 100 raw epochs the output will be 100 weighted epochs. 
4. **process_noise_per_epoch.m**
<BR>Calculates the level of noise present in each channel per epoch. The noise is calculated as the standard deviation (std) of each channel per epoch.
Therefore the output will be noise (i.e. std) on the y-axis and the epoch number on the x-axis. 
5. **process_residual_noise.m**
<BR>Calculates classic and weighted versions of residual noise of each channel after a given number of epochs.
<BR>Classic residual noise = std of each channel over N epochs divided by the square root (sqrt) of the Nth epoch number.
<BR>Weighted residual noise = (std of weighted channels over N epochs divided by sqrt of the Nth epoch number)/(mean of epoch weightings).
7. **process_weighted_averaging.m**
<BR>Calculates epoch-specific weighting by taking the inverse of epoch variance. The weighting is then applied to each epoch.
<BR>The final calculation of weighted average = (sum of weighted epochs)/(sum of epoch weightings). 
8. **process_weighted_merging_rn.m**
<BR>Merges the left and right ABR channels and produces one ABR waveform by using residual noise as the weighting factor. Refer to the third reference article for the mathematical formula. 

### Combined processes
1. **process_wavg_rnoise_nepoch.m**
<BR>Combined process of individual processes 5, 4, and 3. Used mainly for CAEP analysis. 
<BR>Outputs 4 files: weighted average, classic and weighted residual noise, and noise per epoch in this order. 
2. **process_wavg_rnoise_nepoch_fsp.m**
<BR>Combined process of individual processes 1, 3 to 6. Used mainly for ABR analysis. 
<BR>Outputs 7 files: weighted average, weighted merging, classic and weighted residual noise, noise per epoch, and classic and weighted Fsp in this order. 

### Additional resources
**Relevant Brainstorm forums written by the author**
1. [Custom processing for ABR weighted averaging](https://neuroimage.usc.edu/forums/t/custom-processing-for-abr-weighted-averaging/35626)
2. [Custom process that involves merging of channels](https://neuroimage.usc.edu/forums/t/custom-process-that-involves-merging-of-channels/40638)

**References**
<br>Several articles were used for writing these processes, the below highlights the most important three. 
1. [Evaluating residual background noise in human auditory brain‚Äêstem responses](https://pubs.aip.org/asa/jasa/article/96/5/2746/963118/Evaluating-residual-background-noise-in-human)
2. [Quality Estimation of Averaged Auditory Brainstem Responses](https://www.tandfonline.com/doi/abs/10.3109/01050398409043059)
3. [Acoustic change complex for assessing speech discrimination in normal-hearing and hearing-impaired infants](https://www.sciencedirect.com/science/article/pii/S1388245723002195?via%3Dihub)
